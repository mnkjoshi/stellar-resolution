import{ih as N,ii as T,d1 as te,al as Y,ij as b,dW as S,im as y,io as j,is as X,ak as ft,il as x,ch as ee,cj as ne,ci as R,fr as Rt,sB as re,a8 as se,bJ as ae,P as ht,ai as dt,aj as mt,gT as ie,Bz as oe,bI as le,i_ as ue,BA as ce,cg as Lt,ba as yt,r as w,m as C,b as pt,BB as fe,fB as he,fF as de,b1 as me,s as ye,bv as pe,a_ as ge,fw as be}from"./index-BCRx-hwS.js";import{t as $}from"./ImmutableArray-BPVd6ESQ.js";import{y as Se,P as Mt}from"./shared-Bzgpz4qd.js";import{l as _e,p as we}from"./number-jYdrTx4w.js";import{t as Ne}from"./commonProperties-DHiB1uzW.js";function Te(t){if(typeof t=="string")return t.toLowerCase();if("name"in t)return t.name.toLowerCase();if(typeof t.value!="string")throw new N(null,T.InvalidIdentifier,null);return t.value.toLowerCase()}const cn=Object.freeze({aborted:!1});let gt=class{};class V{constructor(){}}function jt(t,e,n){if(t instanceof V&&!(t instanceof it)){const r=new it;return r.fn=t,r.parameterEvaluator=n,r.context=e,r}return t}let hn=class extends V{constructor(e){super(),this.fn=e}createFunction(e){return(...n)=>this.fn(e,{preparsed:!0,arguments:n})}call(e,n){return this.fn(e,n)}marshalledCall(e,n,r,s){return s(e,n,(a,i,l)=>{l=l.map(u=>u instanceof V&&!(u instanceof it)?jt(u,e,s):u);const c=this.call(r,{args:l});return te(c)?c.then(u=>jt(u,r,s)):c})}},it=class extends V{constructor(){super(...arguments),this.fn=null,this.context=null}createFunction(e){return this.fn.createFunction(this.context)}call(e,n){return this.fn.marshalledCall(e,n,this.context,this.parameterEvaluator)}marshalledCall(e,n,r){return this.fn.marshalledCall(e,n,this.context,this.parameterEvaluator)}},K=class zt extends ${constructor(e,n,r,s,a,i){super(e),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=n,this._hasZ=r,this._hasM=s,this._cacheId=a,this._partId=i}get(e){if(this._lazyPt[e]===void 0){const n=this._elements[e];if(n===void 0)return;const r=new Y(n[0],n[1],this._spRef);this._hasZ&&(r.z=n[2]),this._hasM&&(r.m=this._hasZ?n[3]:n[2]),r.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+e.toString(),this._lazyPt[e]=r}return this._lazyPt[e]}equalityTest(e){return e===this||e!==null&&e instanceof zt&&e.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}};class bt extends ${constructor(e,n,r,s,a){super(e),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=r,this._hasM=s,this._spRef=n,this._cacheId=a}get(e){if(this._lazyPath[e]===void 0){const n=this._elements[e];if(n===void 0)return;this._lazyPath[e]=new K(n,this._spRef,this._hasZ,this._hasM,this._cacheId,e)}return this._lazyPath[e]}equalityTest(e){return e===this||e!==null&&e instanceof bt&&e.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}let xe=class{constructor(e){this.value=e}};class ve{constructor(e){this.value=e}}const _={type:"VOID"},Ce=Symbol("BREAK"),ke=Symbol("CONTINUE");function E(t,e,n){return e===""||e==null||e===n||e===n?t:t=t.split(e).join(n)}function B(t){return t instanceof V}function St(t){return t instanceof gt}function G(t){return!!y(t)||!!S(t)||!!d(t)||!!p(t)||!!g(t)||!!b(t)||t===null||t===_||typeof t=="number"}function Ze(t,e){return t===void 0?e:t}function Ae(t){return t==null?"":x(t)||Z(t)?"Array":d(t)?"Date":g(t)?"Time":p(t)?"DateOnly":y(t)?"String":b(t)?"Boolean":S(t)?"Number":(t==null?void 0:t.declaredClass)==="esri.arcade.Attachment"?"Attachment":(t==null?void 0:t.declaredClass)==="esri.arcade.Portal"?"Portal":(t==null?void 0:t.declaredClass)==="esri.arcade.Dictionary"?"Dictionary":xt(t)?"KnowledgeGraph":t instanceof gt?"Module":W(t)?"Feature":t instanceof Y?"Point":t instanceof ht?"Polygon":t instanceof dt?"Polyline":t instanceof mt?"Multipoint":t instanceof ft?"Extent":B(t)?"Function":wt(t)?"FeatureSet":Tt(t)?"FeatureSetCollection":_t(t)?"Voxel":t===_?"":typeof t=="number"&&isNaN(t)?"Number":"Unrecognized Type"}function Oe(t){return t===_}function nt(t){return t instanceof j}function W(t){return(t==null?void 0:t.arcadeDeclaredClass)==="esri.arcade.Feature"}function _t(t){return(t==null?void 0:t.arcadeDeclaredClass)==="esri.arcade.Voxel"}function wt(t){return(t==null?void 0:t.declaredRootClass)==="esri.arcade.featureset.support.FeatureSet"}function Nt(t){return(t==null?void 0:t.declaredClass)==="esri.arcade.Dictionary"}function Fe(t){return Nt(t)||W(t)||_t(t)}function Tt(t){return(t==null?void 0:t.declaredRootClass)==="esri.arcade.featureSetCollection"}function xt(t){return(t==null?void 0:t.declaredClass)==="esri.rest.knowledgeGraph.KnowledgeGraph"}function Z(t){return t instanceof $}function d(t){return t instanceof R}function p(t){return t instanceof ne}function g(t){return t instanceof ee}function ot(t){return t!=null&&typeof t=="object"}function qt(t,e,n,r,s){if(t.length<e||t.length>n)throw new N(r,T.WrongNumberOfParameters,s)}function De(t){return t<0?-Math.round(-t):Math.round(t)}function vt(t,e){return isNaN(t)||e==null||e===""?t.toString():(e=E(e,"‰",""),e=E(e,"¤",""),_e(t,{pattern:e}))}function rt(t,e){return e==null||e===""?t.toISOString(!0):t.toFormat(Yt(e),{locale:Rt(),numberingSystem:"latn"})}function Yt(t,e=!1){t=t.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let n="";const r=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|Z{1,5}|.)/g;for(const s of t.match(r)||[])switch(s){case"D":n+="d";break;case"DD":n+="dd";break;case"DDD":n+="o";break;case"d":n+="c";break;case"ddd":n+="ccc";break;case"dddd":n+="cccc";break;case"M":n+="L";break;case"MM":n+="LL";break;case"MMM":n+="LLL";break;case"MMMM":n+="LLLL";break;case"YY":n+="yy";break;case"Y":case"YYYY":n+="yyyy";break;case"Q":n+="q";break;case"Z":n+="Z";break;case"ZZ":n+="ZZ";break;case"ZZZ":n+="ZZZ";break;case"ZZZZ":n+=e?"[ZZZZ]":"ZZZZ";break;case"ZZZZZ":n+=e?"[ZZZZZ]":"ZZZZZ";break;case"S":n+="'S'";break;case"SS":n+="'SS'";break;case"SSS":n+="u";break;case"A":case"a":n+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":n+=s;break;default:s.length>=2&&s.slice(0,1)==="["&&s.slice(-1)==="]"?n+=`'${s.slice(1,-1)}'`:n+=`'${s}'`}return n}function o(t,e,n){switch(n){case">":return t>e;case"<":return t<e;case">=":return t>=e;case"<=":return t<=e}return!1}function Je(t,e,n){if(t===null){if(e===null||e===_)return o(null,null,n);if(S(e))return o(0,e,n);if(y(e)||b(e))return o(0,f(e),n);if(d(e))return o(0,e.toNumber(),n);if(g(e)||p(e))return o(t,e.toNumber(),n)}if(t===_){if(e===null||e===_)return o(null,null,n);if(S(e))return o(0,e,n);if(y(e)||b(e))return o(0,f(e),n);if(d(e))return o(0,e.toNumber(),n);if(g(e)||p(e))return o(t,e.toNumber(),n)}else if(S(t)){if(S(e))return o(t,e,n);if(b(e))return o(t,f(e),n);if(e===null||e===_)return o(t,0,n);if(y(e))return o(t,f(e),n);if(d(e)||g(e)||p(e))return o(t,e.toNumber(),n)}else if(y(t)){if(y(e))return o(J(t),J(e),n);if(d(e)||g(e)||p(e))return o(f(t),e.toNumber(),n);if(S(e))return o(f(t),e,n);if(e===null||e===_)return o(f(t),0,n);if(b(e))return o(f(t),f(e),n)}else if(d(t)){if(d(e))return t.timeZone!==e.timeZone&&(t.isUnknownTimeZone?t=R.arcadeDateAndZoneToArcadeDate(t,e.timeZone):e.isUnknownTimeZone&&(e=R.arcadeDateAndZoneToArcadeDate(e,t.timeZone))),o(t.toNumber(),e.toNumber(),n);if(e===null||e===_)return o(t.toNumber(),0,n);if(S(e))return o(t.toNumber(),e,n);if(b(e)||y(e))return o(t.toNumber(),f(e),n);if(g(e))throw new N(null,T.CannotCompareDateAndTime,null);if(p(e))return o(t.toNumber(),e.toNumber(),n)}else if(b(t)){if(b(e))return o(t,e,n);if(S(e))return o(f(t),f(e),n);if(d(e)||g(e)||p(e))return o(f(t),e.toNumber(),n);if(e===null||e===_)return o(f(t),0,n);if(y(e))return o(f(t),f(e),n)}else if(p(t)){if(d(e))return o(t.toNumber(),e.toNumber(),n);if(e===null||e===_)return o(t.toNumber(),0,n);if(S(e))return o(t.toNumber(),e,n);if(b(e)||y(e))return o(t.toNumber(),f(e),n);if(g(e))throw new N(null,T.CannotCompareDateAndTime,null);if(p(e))return o(t.toNumber(),e.toNumber(),n)}else if(g(t)){if(d(e))throw new N(null,T.CannotCompareDateAndTime,null);if(e===null||e===_)return o(t.toNumber(),0,n);if(S(e))return o(t.toNumber(),e,n);if(b(e)||y(e))return o(t.toNumber(),f(e),n);if(g(e))return o(t.toNumber(),e.toNumber(),n);if(p(e))throw new N(null,T.CannotCompareDateAndTime,null)}return!!Gt(t,e)&&(n==="<="||n===">=")}function Gt(t,e){if(t===e||t===null&&e===_||e===null&&t===_)return!0;if(d(t)&&d(e)||g(t)&&g(e)||p(t)&&p(e))return t.equals(e);if(t instanceof bt||t instanceof K)return t.equalityTest(e);if(t instanceof Y&&e instanceof Y){const n=t.cache._arcadeCacheId,r=e.cache._arcadeCacheId;if(n!=null)return n===r}return!!(ot(t)&&ot(e)&&(t._arcadeCacheId===e._arcadeCacheId&&t._arcadeCacheId!==void 0&&t._arcadeCacheId!==null||t._underlyingGraphic===e._underlyingGraphic&&t._underlyingGraphic!==void 0&&t._underlyingGraphic!==null))}function Ut(t,{useNumbersForDates:e}){let n="";for(const r in t){n!==""&&(n+=",");const s=t[r];s==null?n+=JSON.stringify(r)+":null":b(s)||S(s)||y(s)?n+=JSON.stringify(r)+":"+JSON.stringify(s):nt(s)?n+=JSON.stringify(r)+":"+q(s):g(s)||p(s)?n+=`${JSON.stringify(r)}:${JSON.stringify(s.toString())}`:Z(s)||Array.isArray(s)?n+=JSON.stringify(r)+":"+q(s,null,e):d(s)?n+=e?JSON.stringify(r)+":"+JSON.stringify(s.getTime()):JSON.stringify(r)+":"+s.stringify():s!==null&&typeof s=="object"&&"castToText"in s&&(n+=JSON.stringify(r)+":"+s.castToText(e))}return"{"+n+"}"}function J(t,e){if(y(t))return t;if(t===null)return"";if(S(t))return vt(t,e);if(b(t))return t.toString();if(d(t))return rt(t,e);if(g(t)||p(t))return t.toFormat(e);if(t instanceof j)return JSON.stringify(t.toJSON());if(x(t)){const n=[];for(let r=0;r<t.length;r++)n[r]=tt(t[r]);return"["+n.join(",")+"]"}if(t instanceof $){const n=[];for(let r=0;r<t.length();r++)n[r]=tt(t.get(r));return"["+n.join(",")+"]"}return t!==null&&typeof t=="object"&&"castToText"in t?t.castToText():B(t)?"object, Function":t===_?"":St(t)?"object, Module":""}function $e(t){const e=[];if(t instanceof $){for(let n=0;n<t.length();n++)e[n]=f(t.get(n));return e}if(!x(t))return null;for(let n=0;n<t.length;n++)e[n]=f(t[n]);return e}function q(t,e,n=!1){if(y(t))return t;if(t===null)return"";if(S(t))return vt(t,e);if(b(t))return t.toString();if(d(t))return rt(t,e);if(g(t)||p(t))return t.toFormat(e);if(t instanceof j)return t instanceof ft?'{"xmin":'+t.xmin.toString()+',"ymin":'+t.ymin.toString()+","+(t.hasZ?'"zmin":'+t.zmin.toString()+",":"")+(t.hasM?'"mmin":'+t.mmin.toString()+",":"")+'"xmax":'+t.xmax.toString()+',"ymax":'+t.ymax.toString()+","+(t.hasZ?'"zmax":'+t.zmax.toString()+",":"")+(t.hasM?'"mmax":'+t.mmax.toString()+",":"")+'"spatialReference":'+lt(t.spatialReference)+"}":lt(t.toJSON(),(r,s)=>r.key===s.key?0:r.key==="spatialReference"?1:s.key==="spatialReference"||r.key<s.key?-1:r.key>s.key?1:0);if(x(t)){const r=[];for(let s=0;s<t.length;s++)r[s]=tt(t[s],n);return"["+r.join(",")+"]"}if(t instanceof $){const r=[];for(let s=0;s<t.length();s++)r[s]=tt(t.get(s),n);return"["+r.join(",")+"]"}return t!==null&&typeof t=="object"&&"castToText"in t?t.castToText(n):B(t)?"object, Function":t===_?"":St(t)?"object, Module":""}function tt(t,e=!1){if(t===null)return"null";if(b(t)||S(t)||y(t))return JSON.stringify(t);if(t instanceof j||t instanceof $||Array.isArray(t))return q(t,null,e);if(d(t))return JSON.stringify(e?t.getTime():rt(t,""));if(g(t)||p(t))return JSON.stringify(t.toString());if(t!==null&&typeof t=="object"){if("castToText"in t)return t.castToText(e)}else if(t===_)return"null";return"null"}function f(t,e){return S(t)?t:t===null||t===""?0:d(t)||p(t)||g(t)?NaN:b(t)?t?1:0:x(t)||t===""||t===void 0?NaN:e!==void 0&&y(t)?(e=E(e,"‰",""),e=E(e,"¤",""),we(t,{pattern:e})):t===_?0:Number(t)}function Le(t,e){if(d(t))return t;if(y(t)){const n=Me(t,e);if(n)return R.dateTimeToArcadeDate(n)}return null}function Me(t,e){const n=/ (\d\d)/,r=ce(e);let s=Lt.fromISO(t,{zone:r});return s.isValid||n.test(t)&&(t=t.replace(n,"T$1"),s=Lt.fromISO(t,{zone:e}),s.isValid)?s:null}function je(t){return b(t)?t:y(t)?(t=t.toLowerCase())==="true":!!S(t)&&t!==0&&!isNaN(t)}function Pe(t,e){const n=JSON.parse(t);return n&&!n.spatialReference&&(n.spatialReference=e),ae(n)}function Ie(t,e){return t==null?null:(t.spatialReference!==null&&t.spatialReference!==void 0||(t.spatialReference=e),t)}function Re(t){if(t===null)return null;if(t instanceof Y)return t.x==="NaN"||t.x===null||isNaN(t.x)?null:t;if(t instanceof ht){if((t.curveRings??t.rings).length===0)return null;for(const e of t.curveRings??t.rings)if(e.length>0)return t;return null}if(t instanceof dt){if((t.curvePaths??t.paths).length===0)return null;for(const e of t.curvePaths??t.paths)if(e.length>0)return t;return null}return t instanceof mt?t.points.length===0?null:t:t instanceof ft?t.xmin==="NaN"||t.xmin===null||isNaN(t.xmin)?null:t:null}function Bt(t,e){if(!t||!t.domain)return e;let n=null,r=null;if(d(e))n=e.toNumber();else if(p(e))n=e.toString();else if(g(e))n=e.toStorageString();else if(t.field.type==="string"||t.field.type==="esriFieldTypeString")n=J(e);else{if(e==null)return null;if(e==="")return e;n=f(e)}for(let s=0;s<t.domain.codedValues.length;s++){const a=t.domain.codedValues[s];a.code===n&&(r=a)}return r===null?J(e):r.name}function Vt(t,e){if(!t||!t.domain)return e;let n=null;const r=J(e);for(let s=0;s<t.domain.codedValues.length;s++){const a=t.domain.codedValues[s];a.name===r&&(n=a)}return n===null?e:n.code}function st(t,e,n=null,r=null){if(!e||!e.fields)return null;let s,a,i=null;for(let h=0;h<e.fields.length;h++){const m=e.fields[h];m.name.toLowerCase()===t.toString().toLowerCase()&&(i=m)}if(i===null)throw new N(null,T.FieldNotFound,null,{key:t});let l=e.typeIdField,c="id",u=e.types;if(e.subtypeField&&(l=e.subtypeField,c="code",u=e.subtypes??[]),r===null&&n&&l)r=n.hasField(l)?n.field(l):null;else if(l&&r!==null){let h=!1;for(const m of u||[])if(r===m[c]){h=!0;break}if(!h){for(const m of u||[])if(r===m.name){r=m[c],h=!0;break}}h||(r=null,n&&l&&(r=n.hasField(l)?n.field(l):null))}return r!=null&&u.some(h=>{var m;return h[c]===r&&(s=(m=h.domains)==null?void 0:m[i.name],s&&s.type==="inherited"&&(s=Pt(i.name,e),a=!0),!0)}),a||s||(s=Pt(t,e)),{field:i,domain:s}}function Pt(t,e){let n;return e.fields.some(r=>(r.name.toLowerCase()===t.toLowerCase()&&(n=r.domain),!!n)),n}function lt(t,e){e||(e={}),typeof e=="function"&&(e={cmp:e});const n=typeof e.cycles=="boolean"&&e.cycles,r=e.cmp&&(s=e.cmp,function(i){return function(l,c){const u={key:l,value:i[l]},h={key:c,value:i[c]};return s(u,h)}});var s;const a=[];return function i(l){if(l!=null&&l.toJSON&&typeof l.toJSON=="function"&&(l=l.toJSON()),l===void 0)return;if(typeof l=="number")return isFinite(l)?""+l:"null";if(typeof l!="object")return JSON.stringify(l);let c,u;if(Array.isArray(l)){for(u="[",c=0;c<l.length;c++)c&&(u+=","),u+=i(l[c])||"null";return u+"]"}if(l===null)return"null";if(a.includes(l)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const h=a.push(l)-1,m=Object.keys(l).sort(r==null?void 0:r(l));for(u="",c=0;c<m.length;c++){const F=m[c],v=i(l[F]);v&&(u&&(u+=","),u+=JSON.stringify(F)+":"+v)}return a.splice(h,1),"{"+u+"}"}(t)}function ze(t){if(t===null)return null;const e=[];for(const n of t)W(n)?e.push(n.geometry()):e.push(n);return e}function U(t,e){if(!(e instanceof Y))throw new N(null,T.InvalidParameter,null);t.push(e.hasZ?e.hasM?[e.x,e.y,e.z,e.m]:[e.x,e.y,e.z]:[e.x,e.y])}function qe(t,e){if(x(t)||Z(t)){let n=!1,r=!1,s=[],a=e;if(x(t)){for(const i of t)U(s,i);s.length>0&&(a=t[0].spatialReference,n=t[0].hasZ,r=t[0].hasM)}else if(t instanceof K)s=t._elements,s.length>0&&(n=t._hasZ,r=t._hasM,a=t.get(0).spatialReference);else{if(!Z(t))throw new N(null,T.InvalidParameter,null);for(const i of t.toArray())U(s,i);s.length>0&&(a=t.get(0).spatialReference,n=t.get(0).hasZ===!0,r=t.get(0).hasM===!0)}return s.length===0?null:(ue(s)||(s=s.slice().reverse()),new ht({rings:[s],spatialReference:a,hasZ:n,hasM:r}))}return t}function Ye(t,e){if(x(t)||Z(t)){let n=!1,r=!1,s=[],a=e;if(x(t)){for(const i of t)U(s,i);s.length>0&&(a=t[0].spatialReference,n=t[0].hasZ===!0,r=t[0].hasM===!0)}else if(t instanceof K)s=t._elements,s.length>0&&(n=t._hasZ,r=t._hasM,a=t.get(0).spatialReference);else if(Z(t)){for(const i of t.toArray())U(s,i);s.length>0&&(a=t.get(0).spatialReference,n=t.get(0).hasZ===!0,r=t.get(0).hasM===!0)}return s.length===0?null:new dt({paths:[s],spatialReference:a,hasZ:n,hasM:r})}return t}function Ge(t,e){if(x(t)||Z(t)){let n=!1,r=!1,s=[],a=e;if(x(t)){for(const i of t)U(s,i);s.length>0&&(a=t[0].spatialReference,n=t[0].hasZ===!0,r=t[0].hasM===!0)}else if(t instanceof K)s=t._elements,s.length>0&&(n=t._hasZ,r=t._hasM,a=t.get(0).spatialReference);else if(Z(t)){for(const i of t.toArray())U(s,i);s.length>0&&(a=t.get(0).spatialReference,n=t.get(0).hasZ===!0,r=t.get(0).hasM===!0)}return s.length===0?null:new mt({points:s,spatialReference:a,hasZ:n,hasM:r})}return t}function ut(t,e=!0){if(t==null)return[];if(x(t)){const n=[];for(const r of t){const s=J(r);(e||s!=="")&&n.push(s)}return n}if(Z(t)){const n=[];for(let r=0;r<t.length();r++){const s=J(t.get(r));(e||s!=="")&&n.push(s)}return n}if(G(t)){const n=J(t);if(e||n!=="")return[n]}return[]}let at=0;function Ue(t){return at++,at%100==0?(at=0,new Promise(e=>{setTimeout(()=>{e(t)},0)})):t}function Be(t,e,n){switch(n){case"&":return t&e;case"|":return t|e;case"^":return t^e;case"<<":return t<<e;case">>":return t>>e;case">>>":return t>>>e}}function z(t,e=null){return t==null?null:b(t)||S(t)||y(t)?t:t instanceof j?(e==null?void 0:e.keepGeometryType)===!0?t:t.toJSON():t instanceof $?t.toArray().map(n=>z(n,e)):Array.isArray(t)?t.map(n=>z(n,e)):X(t)?t:d(t)?t.toJSDate():g(t)?t.toString():p(t)?t.toJSDate():t!==null&&typeof t=="object"&&t.castAsJson!==void 0?t.castAsJson(e):null}async function Ve(t,e,n,r,s){const a=await Ct(t,e,n);s[r]=a}async function Ct(t,e=null,n=null){if(t instanceof $&&(t=t.toArray()),t==null)return null;if(G(t)||t instanceof j||X(t)||d(t))return z(t,n);if(Array.isArray(t)){const r=[],s=[];for(const a of t)a===null||G(a)||a instanceof j||X(a)||d(a)?s.push(z(a,n)):(s.push(null),r.push(Ve(a,e,n,s.length-1,s)));return r.length>0&&await Promise.all(r),s}return t!==null&&typeof t=="object"&&t.castAsJsonAsync!==void 0?t.castAsJsonAsync(e,n):null}function Q(t){return Et(t)?t.parent:t}function Et(t){return t&&"declaredClass"in t&&t.declaredClass==="esri.layers.support.SubtypeSublayer"}function Ee(t){return t&&"declaredClass"in t&&t.declaredClass==="esri.layers.SubtypeGroupLayer"}function He(t,e,n){const r=Q(t.fullSchema());return r===null||!r.fields?null:st(e,r,t,n)}function Ke(t){const e=Q(t.fullSchema());return e===null?null:e.fields?e.subtypeField?{subtypeField:e.subtypeField,subtypes:e.subtypes?e.subtypes.map(n=>({name:n.name,code:n.code})):[]}:e.typeIdField?{subtypeField:e.typeIdField,subtypes:e.types?e.types.map(n=>({name:n.name,code:n.id})):[]}:null:null}function We(t,e,n,r){const s=Q(t.fullSchema());if(s===null||!s.fields)return null;const a=st(e,s,t,r);if(n===void 0)try{n=t.field(e)}catch{return null}return Bt(a,n)}function Qe(t,e,n,r){const s=Q(t.fullSchema());if(s===null||!s.fields)return null;if(n===void 0){try{n=t.field(e)}catch{return null}return n}return Vt(st(e,s,t,r),n)}function Xe(t){return(t==null?void 0:t.timeZone)??"system"}function tn(t){const e=Q(t.fullSchema());if(e===null||!e.fields)return null;const n=[];for(const r of e.fields)n.push(Se(r));return{objectIdField:e.objectIdField,globalIdField:e.globalIdField??"",geometryType:Mt[e.geometryType]===void 0?"":Mt[e.geometryType],fields:n}}function en(t,e){const n=R.systemTimeZoneCanonicalName;return t==="system"&&(t=n),{version:Ht,engineVersion:oe,timeZone:t,userTimeZone:n,spatialReference:e instanceof le?e.toJSON():e,application:ie.applicationName??"",engine:"web",locale:Rt()}}const Ht="1.32",pn=Object.freeze(Object.defineProperty({__proto__:null,ImplicitResult:ve,ReturnResult:xe,absRound:De,arcadeVersion:Ht,autoCastArrayOfPointsToMultiPoint:Ge,autoCastArrayOfPointsToPolygon:qe,autoCastArrayOfPointsToPolyline:Ye,autoCastFeatureToGeometry:ze,binaryOperator:Be,breakResult:Ce,castAsJson:z,castAsJsonAsync:Ct,castRecordToText:Ut,continueResult:ke,defaultExecutingContext:en,defaultTimeZone:Xe,defaultUndefined:Ze,equalityTest:Gt,featureDomainCodeLookup:Qe,featureDomainValueLookup:We,featureFullDomain:He,featureSchema:tn,featureSubtypes:Ke,fixNullGeometry:Re,fixSpatialReference:Ie,formatDate:rt,formatNumber:vt,getDomain:st,getDomainCode:Vt,getDomainValue:Bt,getType:Ae,greaterThanLessThan:Je,isArray:x,isBoolean:b,isDate:d,isDateOnly:p,isDictionary:Nt,isDictionaryLike:Fe,isFeature:W,isFeatureSet:wt,isFeatureSetCollection:Tt,isFunctionParameter:B,isGeometry:nt,isGraphic:se,isImmutableArray:Z,isInteger:re,isJsDate:X,isKnowledgeGraph:xt,isModule:St,isNumber:S,isObject:ot,isSimpleType:G,isString:y,isSubtypeGrouplayer:Ee,isSubtypeSublayer:Et,isTime:g,isVoid:Oe,isVoxel:_t,multiReplace:E,parseGeometryFromJson:Pe,pcCheck:qt,stableStringify:lt,standardiseDateFormat:Yt,tick:Ue,toBoolean:je,toDate:Le,toNumber:f,toNumberArray:$e,toString:J,toStringArray:ut,toStringExplicit:q,voidOperation:_},Symbol.toStringTag,{value:"Module"}));function gn(t){Kt=t}let Kt;function ct(t){return t===null?null:d(t)?t.clone():G(t)?t:nt(t)?t.clone():Z(t)?t.toArray().map(e=>ct(e)):x(t)?t.map(e=>ct(e)):W(t)?Kt.createFromArcadeFeature(t):Tt(t)||wt(t)?t:Nt(t)||(t==null?void 0:t.declaredClass)==="esri.arcade.Attachment"?t.deepClone():((t==null?void 0:t.declaredClass)==="esri.arcade.Portal"||xt(t)||t instanceof gt||B(t),t)}function et(t,e,n=!1,r=!1){if(t==null)return null;if(S(t)||b(t)||y(t)||d(t)||p(t)||g(t))return t;if(x(t)){const a=[];for(const i of t)a.push(et(i,e,n,r));return a}if(r&&nt(t))return t;const s=new O;s.immutable=!1;for(const[a,i]of Object.entries(t))i!==void 0&&s.setField(a,et(i,e,n,r));return s.immutable=n,s}class O{constructor(e){this.declaredClass="esri.arcade.Dictionary",this.plain=!1,this.immutable=!0,e instanceof O?this.attributes=e.attributes:e==null?this.attributes=Object.create(null):Object.getPrototypeOf(e)!=null?this.attributes={__proto__:null,...e}:this.attributes=e}static containerEntry(e,n){return new O({__proto__:null,key:e,value:n})}static textFormatting(){const e=new O({__proto__:null,newline:`
`,tab:"	",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});return e.immutable=!1,e}field(e){const n=e.toLowerCase(),r=this.attributes[e];if(r!==void 0)return r;for(const s in this.attributes)if(s.toLowerCase()===n)return this.attributes[s];throw new N(null,T.FieldNotFound,null,{key:e})}setField(e,n){if(this.immutable)throw new N(null,T.Immutable,null);if(B(n))throw new N(null,T.NoFunctionInDictionary,null);const r=e.toLowerCase();if(n instanceof Date&&(n=R.dateJSToArcadeDate(n)),this.attributes[e]===void 0){for(const s in this.attributes)if(s.toLowerCase()===r)return void(this.attributes[s]=n);this.attributes[e]=n}else this.attributes[e]=n}hasField(e){const n=e.toLowerCase();if(this.attributes[e]!==void 0)return!0;for(const r in this.attributes)if(r.toLowerCase()===n)return!0;return!1}keys(){let e=[];for(const n in this.attributes)e.push(n);return e=e.sort(),e}castToText(e=!1){return Ut(this.attributes,{useNumbersForDates:e})}static convertObjectToArcadeDictionary(e,n,r=!0,s=!1){const a=new O;a.immutable=!1;for(const i in e){const l=e[i];l!==void 0&&a.setField(i.toString(),et(l,n,r,s))}return a.immutable=r,a}static convertJsonToArcade(e,n,r=!1,s=!1){return et(e,n,r,s)}castAsJson(e=null){const n=Object.create(null);for(let r in this.attributes){const s=this.attributes[r];s!==void 0&&(e!=null&&e.keyTranslate&&(r=e.keyTranslate(r)),n[r]=z(s,e))}return n}async castDictionaryValueAsJsonAsync(e,n,r,s=null,a){const i=await Ct(r,s,a);return e[n]=i,i}async castAsJsonAsync(e=null,n=null){const r=Object.create(null),s=[];for(let a in this.attributes){const i=this.attributes[a];n!=null&&n.keyTranslate&&(a=n.keyTranslate(a)),i!==void 0&&(G(i)||i instanceof j||i instanceof R?r[a]=z(i,n):s.push(this.castDictionaryValueAsJsonAsync(r,a,i,e,n)))}return s.length>0&&await Promise.all(s),r}deepClone(){const e=new O;e.immutable=!1;for(const n of this.keys())e.setField(n,ct(this.field(n)));return e}}let D=class extends yt{constructor(t){super(t),this.text=null,this.detectedLanguage="en",this.detectedLanguageScore=-1}};w([C({type:String,json:{write:!0}})],D.prototype,"key",void 0),w([C({type:String,json:{write:!0}})],D.prototype,"text",void 0),w([C({type:String,json:{read:{source:"detectedLanguage.language"},write:{target:"detectedLanguage.language"}}})],D.prototype,"detectedLanguage",void 0),w([C({type:Number,json:{read:{source:"detectedLanguage.score"},write:{target:"detectedLanguage.score"}}})],D.prototype,"detectedLanguageScore",void 0),w([C({type:Object,json:{write:!0}})],D.prototype,"translation",void 0),D=w([pt("esri.rest.support.TranslateResult")],D);async function nn(t,e,n){const r=e.toJSON();r.contents=JSON.stringify(r.contents),r.token=await fe(e.portalUrl,e.apiKey,{signal:n==null?void 0:n.signal,prompt:(n==null?void 0:n.authMode)!=="no-prompt"});const s=he(t),a=de(s.query,{...n,query:r,method:"post",authMode:"anonymous"});return(await me(s.path,a)).data.results.map(i=>D.fromJSON(i))}let I=class extends yt{constructor(t){super(t)}};w([C({type:String,json:{write:!0}})],I.prototype,"key",void 0),w([C({type:String,json:{write:!0}})],I.prototype,"text",void 0),I=w([pt("esri.rest.support.TranslateContent")],I);let A=class extends yt{constructor(t){super(t),this.to=null,this.contents=null,this.portalUrl="https://www.arcgis.com",this.translator="esri",this.from=null,this.apiKey=null,this.requestSource=null}};w([C({type:[String],json:{write:!0}})],A.prototype,"to",void 0),w([C({type:[I],json:{write:!0}})],A.prototype,"contents",void 0),w([C({type:String,json:{write:!0}})],A.prototype,"portalUrl",void 0),w([C({type:String,json:{write:!0,default:"esri"}})],A.prototype,"translator",void 0),w([C({type:String,json:{write:!0}})],A.prototype,"from",void 0),w([C(Ne)],A.prototype,"apiKey",void 0),w([C({type:String,json:{name:"x-esri-request-source"}})],A.prototype,"requestSource",void 0),A=w([pt("esri.rest.support.TranslateParameters")],A);class kt{constructor(e,n){this.portal=e,this._debugLog=n}async translate(e){var s;this.portal.loaded||await this.portal.load();const n=(s=this.portal.helperServices)==null?void 0:s.aiUtilityServices;if(n==null)return{success:!1};const r=n.url+n.translateUtility;try{return e.requestSource??(e.requestSource="arcade"),{success:!0,results:(await nn(r,e,{authMode:"no-prompt"})).map(a=>a.toJSON())}}catch(a){return this._debugLog!=null&&(a instanceof Error||a instanceof ye)&&this._debugLog(`TranslateText error: ${a.message}`),pe.getLogger("esri.arcade.functions.aiServices").error(a),{success:!1}}}}class rn{constructor(e,n,r){this._parameters=e,this._maxTotalContentSize=n,this._maxContentsLength=r,this._requests=[],this._normalizedContents=new Map,this._contentsTotalSize=0}tryAdd(e){const n=new Set(e.filter(a=>!this._normalizedContents.has(a.text)).map(a=>a.text));if(this._requests.length+n.size>this._maxContentsLength)return null;let r=0;for(const a of n)r+=a.length;if((r+this._contentsTotalSize)*(this._parameters.to.length??1)>this._maxTotalContentSize)return null;const s=this._requests.length;for(const{key:a,text:i}of e)be(this._normalizedContents,i,()=>[]).push({batchIdx:s,key:a});return this._requests.push(e),this._contentsTotalSize+=r,s}async send(e){const n=[],r=[];let s=0;for(const[c,u]of this._normalizedContents)n.push(new I({key:String(s++),text:c})),r.push(u);const a=new A(this._parameters);a.contents=n;const i=await e.translate(a);if(!i.success)return Array.from(this._requests,()=>i);const l=Array.from(this._requests,()=>({success:!0,results:[]}));for(const c of i.results){const u=Number(c.key);for(const h of r[u])l[h.batchIdx].results.push({...c,key:h.key})}return l}}function H(t){const e=[...new Set(t.to)].sort(),n=t.from??null,r=t.portalUrl,s=t.translator,a=t.apiKey??null;return JSON.stringify([e,n,r,s,a])}async function It(t,e,n){try{return(await t.yieldFor(n))[e]}catch{return{success:!1}}}class Wt{constructor(e,n,{maxTotalContentSize:r=5e4,maxContentsLength:s=1e3}={}){this._executor=e,this._service=n,this._openBatches=new Map,this._maxTotalContentSize=r,this._maxContentsLength=s}create(e){return{translate:async n=>{const r=H(n),{contents:s,to:a,from:i,translator:l,portalUrl:c,apiKey:u}=n;if(a==null)return{success:!1};if(s==null||s.every(v=>v.text.length===0))return{success:!1};const h=this._openBatches.get(r);if(h!=null){const v=h.data.tryAdd(s);if(v!=null)return await It(e,v,h);h.send()}const m=new rn({to:a,from:i,translator:l,portalUrl:c,apiKey:u},this._maxTotalContentSize,this._maxContentsLength),F=m.tryAdd(s);if(F!=null){const v=this._executor.openBatch(m,{open:P=>{this._openBatches.set(r,P)},execute:P=>P.send(this._service),close:P=>{this._openBatches.get(r)===P&&this._openBatches.delete(r)}});return await It(e,F,v)}return await this._service.translate(n)}}}}function Qt(t){t.mode==="async"&&(t.functions[Te("TranslateText")]=function(e,n){return t.standardFunctionAsync(e,n,async(r,s,a)=>{var Zt,At,Ot,Ft,Dt,Jt;if(qt(a,2,3,r,s),!y(a[0])&&!x(a[0])&&!Z(a[0]))throw new N(r,T.InvalidParameter,s);const i=ut(a[0]);if(!y(a[1])&&!x(a[1])&&!Z(a[1]))throw new N(r,T.InvalidParameter,s);const l=ut(a[1]);let c=null;if(a.length>=3){if(!y(a[2]))throw new N(r,T.InvalidParameter,s);c=a[2]}const u=i.map((L,k)=>new I({key:String(k),text:L})),h=((Zt=r.services)==null?void 0:Zt.portal)??ge.getDefault(),m=new A({to:l,contents:u,from:c,portalUrl:h.restUrl.replace(/\/sharing\/rest$/,"")}),F=new Map;let v=null;if(r.lrucache!=null){const L=r.lrucache;v??(v=H(m)),m.contents=(At=m.contents)==null?void 0:At.filter(k=>{const M=L.getCachedTranslation(v,k.text);return M==null||(F.set(k.key,{...M,key:k.key,text:k.text}),!1)})}if((Ot=m.contents)!=null&&Ot.length){const L=((Ft=r.services)==null?void 0:Ft.translation)??new kt(h,r.console),k=await L.translate(m);if(!k.success)return new O({__proto__:null,success:!1});for(const M of k.results){const $t=(Jt=(Dt=m.contents)==null?void 0:Dt.find(Xt=>Xt.key===M.key))==null?void 0:Jt.text;if($t==null)throw new N(null,T.NeverReach,null);F.set(M.key,M),r.lrucache!=null&&(v??(v=H(m)),r.lrucache.setCachedTranslation(v,$t,{detectedLanguage:M.detectedLanguage,translation:M.translation}))}}const P=Array.from(u,L=>{const k=D.fromJSON(F.get(L.key));if(k==null)throw new N(null,T.NeverReach,null);return k.text=L.text,O.convertJsonToArcade(k.toJSON(),r.timeZone??"system",!0)});return new O({__proto__:null,success:!0,results:P})})})}const bn=Object.freeze(Object.defineProperty({__proto__:null,BatchTranslationServiceFactory:Wt,PortalTranslationService:kt,getTranslateParametersKey:H,registerFunctions:Qt},Symbol.toStringTag,{value:"Module"})),Sn=Object.freeze(Object.defineProperty({__proto__:null,BatchTranslationServiceFactory:Wt,PortalTranslationService:kt,getTranslateParametersKey:H,registerFunctions:Qt},Symbol.toStringTag,{value:"Module"}));export{W as $,g as A,Qe as B,st as C,Bt as D,Nt as E,Ut as F,B as G,nt as H,_ as I,Ie as J,wt as K,Ge as L,qe as M,f as N,Vt as O,Ce as P,Fe as Q,Ye as R,Le as S,je as T,Oe as U,ut as V,tn as W,Tt as X,ke as Y,E as Z,ve as _,qt as a,Ue as a0,Et as a1,K as a2,bt as a3,G as a4,z as a5,gn as a6,ct as a7,Ae as a8,Yt as a9,De as aa,Re as ab,_t as ac,$e as ad,en as ae,pn as af,Sn as ag,Z as b,Be as c,Gt as d,hn as e,jt as f,gt as g,bn as h,Xe as i,O as j,He as k,Ke as l,Je as m,cn as n,We as o,J as p,Ze as q,V as r,it as s,Te as t,q as u,xe as v,ze as w,xt as x,d as y,p as z};
